---
title: "Exam_2_Draft"
format: 
  html:
    self-contained: true
    theme: minty
editor: visual
---

## Info on exam

There will be four different tasks with various sub-tasks and the following points:

1.  single choice questions - 30p
2.  Code explanation - 18p
3.  Regression - 24p
4.  Regularization and Generalisability - 18p

-   The exam consists of 90p total.

-   The pure processing time is 120 minutes

-   authorized aids: Dictionary and calculator / zugelassene Hilfsmittel: Wörterbuch und Taschenrechner

    ::: callout-note
    You are free to choose between answering the questions in English OR German, but please stick to one language and do not switch in-between sentences/tasks.
    :::

-   Be brief, be precise. Only answer the things that are asked. There are no extra points if you write more than required!

-   The exam consists of two parts: a multiple choice and a text task part. Both parts must be completed in full.

-   Define each abbreviation (e.g. σ) at least once if it is not already predefined!

-   You are not supposed to answer with handwritten code but rather with “normal” text.

-   Use as many post decimal digits (“Nachkommastellen”) as stated - if NOT stated, use two

-   If you need additional space, use the attached empty pages and leave a clear remark at each task, that you used them and where to find your answer(s).

::: callout-important
If you are not sure on the translation of a certain term from English to German please ask the exam supervisors!
:::

# Task 1: single choice Questions (30p)

10 questions, 3p each!

::: callout-note
Please note, that exactly one single answers is correct.
:::

## **Task 1.1**

Which of the following statements describes symptoms of **overfitting** in a linear regression model?

a.  ⬜ The model performs well on training data but poorly on unseen test data.
b.  ⬜ The model has high bias and performs poorly on both training and test data.
c.  ⬜ The model performs well on both training and test data.
d.  ⬜ The model has low variance and captures no noise in the training data.

## Task 1.2

In the context of data science, which of the following best describes the concept of **generalizability**?

a.  ⬜ The ability of a model to perfectly predict the target variable for the training data.
b.  ⬜ The ability of a model to identify patterns in a dataset that can be applied to other similar datasets.
c.  ⬜ The ability of a model to memorize specific examples from the training data.
d.  ⬜ The ability to visualize and interpret the training data in multiple ways.

## Task 1.3

What does the $$R^2$$ **represent in a linear regression model**?

a.  ⬜ The percentage of the total variation in the dependent variable explained by the independent variable(s).
b.  ⬜ The strength and direction of the correlation between the dependent and independent variables.
c.  ⬜ The average error of the predictions made by the model.
d.  ⬜ The proportion of the independent variable's variance that is unexplained by the model.

## Task 1.4

Which of the following best describes the purpose of a **simple linear regression model?**

a.  ⬜ To determine the exact cause of changes in a dependent variable.
b.  ⬜ To estimate the relationship between one dependent variable and one independent variable.
c.  ⬜ To calculate the mean of a dataset.
d.  ⬜ To analyse the relationship between multiple dependent variables.

## Task 1.5

In regularization techniques like Ridge and Lasso regression, what effect does increasing the **regularization parameter** ($\lambda$) have on the model?

a.  ⬜ It increases the complexity of the model by allowing larger coefficients.
b.  ⬜ It reduces the magnitude of small coefficients, leading to simpler models and less overfitting.
c.  ⬜ It has no impact on the model's coefficients or complexity.
d.  ⬜ It increases the model's sensitivity to noise in the training data.

## Task 1.6

Which of these statements is correct when it comes to the use of **test data and training data in data science**?

a.  ⬜ Training data is used to evaluate the performance of the model, while test data is used to train the model.
b.  ⬜ Both training and test data should always contain the same data points to make comparisons easier.
c.  ⬜ A model is fit on the training set, and the fitted model is used to predict the responses for the observations in the validation set.
d.  ⬜ We always train a model on 5% of the data set and validate on 95% of the data for having greater generalization performance.

## Task 1.7

In R, what function is commonly used to **transform data into a data frame**?

a.  ⬜ matrix()
b.  ⬜ as.data.frame()
c.  ⬜ df()
d.  ⬜ table()

## Task 1.8

Which package in R is commonly used for creating advanced **graphics**?

a.  ⬜ ggplot2
b.  ⬜ dplyr
c.  ⬜ tidyr
d.  ⬜ shiny

## Task 1.9

What does '**pruning**' refer to in the context of decision trees?

a.  ⬜ Increasing the number of features considered in the model to provide more complexity.
b.  ⬜ Aggregating the results of multiple decision trees into a single model for better accuracy.
c.  ⬜ Refining the model by removing branches that do not significantly contribute to predictive power
d.  ⬜ Utilizing cross-validation techniques to determine significant branches.

## Task 1.10

After fitting a linear regression model in R using the `lm()` function, you obtain the following output for the model coefficients:

$$\text{(Intercept)} = 5.2, \quad \beta_1 = 2.4, \quad \beta_2 = -0.8$$ Given this model:

$$ \hat{y} = 5.2 + 2.4 \times X_1 - 0.8 \times X_2$$

What can be inferred from $\beta_1$ in this model?

a.  ⬜ For each unit increase in $X_1$, the predicted value of $y$ will increase by 5.2.
b.  ⬜ For each unit increase in $X_1$, the predicted value of $y$ will increase by 2.4, assuming $X_2$ remains constant.
c.  ⬜ For each unit increase in $X_2$, the predicted value of $y$ will increase by 0.8, assuming $X_1$ remains constant.
d.  ⬜ The value of $y$ is independent of $X_1$ and only depends on $X_2$.

# Task 2: Code interpretation

The dataset `energy` will be used in multiple tasks. In task 2.1 you will clean it, in task 2.2 you will use it in a plotting task.

`energy` includes data on a countries CO2-emissions and related metrics. In the data description you can see the variables meaning and units.

```{r}
#| echo: false
options(scipen = 999)
library(readr)
energy <- read_csv("energy.csv", show_col_types = FALSE)
energy<- na.omit(energy)
```

## Data Description

+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| name of the variable            | explanation                                                                                                                                                                          | explanation on unit                                                                          |
+=================================+======================================================================================================================================================================================+==============================================================================================+
| **Country**                     | Country in question                                                                                                                                                                  |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Energy_type**                 | Type of energy source                                                                                                                                                                |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Year**                        | Year the data was recorded                                                                                                                                                           |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Energy_consumption** -        | Amount of Consumption for the specific energy source, measured (quad Btu)                                                                                                            | -   **Energieeinheit, die 1 Billiarde (10 ^15^ ) British Thermal Units (BTU) entspricht**    |
|                                 |                                                                                                                                                                                      |                                                                                              |
|                                 |                                                                                                                                                                                      | -   Unit of energy, equivalent to 1 quadrillion (**10 ^15^** ) British Thermal Units (BTU)\] |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Energy_production**           | Amount of Production for the specific energy source, measured (quad Btu)                                                                                                             | -   **Energieeinheit, die 1 Billiarde (10 ^15^ ) British Thermal Units (BTU) entspricht**    |
|                                 |                                                                                                                                                                                      |                                                                                              |
|                                 |                                                                                                                                                                                      | -   Unit of energy, equivalent to 1 quadrillion (**10 ^15^** ) British Thermal Units (BTU)\] |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **GDP**                         | Countries GDP at purchasing power parities, measured (Billion 2015\$ PPP)                                                                                                            |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Population**                  | Population of specific Country, measured (Mperson)                                                                                                                                   |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Energy_intensity_per_capita** | Energy intensity is a measure of the energy inefficiency of an economy. It is calculated as units of energy per unit of capita (capita = individual person), measured (MMBtu/person) |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **Energy_intensity_by_GDP**     | Energy intensity is a measure of the energy inefficiency of an economy. It is calculated as units of energy per unit of GDP, measured (1000 Btu/2015\$ GDP PPP)                      |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+
| **CO2_emission** -              | The amount of C02 emitted, measured (MMtonnes CO2)                                                                                                                                   |                                                                                              |
+---------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------+

## Task 2.1 (12p in total)

Below is a subset of the dataset `energy`. The code to prepare the data for further analysis in task 3. Follow the steps in the code and update the table by hand (8p).

```{r}
library(dplyr) #responsible for the "filter" command

energy$Country <- as.factor (energy$Country)
energy_2019 <- energy %>%
  filter(Year >= 2019)

energy_2019 <- energy_2019 %>%
  filter(Energy_type == "all_energy_types")

energy_2019 <- energy_2019 %>%
  filter(Country != "World")

energy_clean_2019 <- na.omit(energy_2019)
```

**2.1.2. Did you remove singular values and/or rows and/or columns? If you did so, explain why. (2p)**

> 3P for removal of observations prior to 2019 - row-removal
>
> 2P for removal of energy type coal - row-removal
>
> 1P for removal of "World"-row
>
> 2P for removal of NA-rows

**2.1.3. After applying the code: Are any values left that could potentially lead to problems? If so, how could we fix that problem (answer verbally, no code needed)? (2p)**

![](table_exam.PNG)

## Task 2.2 (6p in total)

Task 2.2 (3p) What kind of plot gets generated by this code? Choose the correct one below and justify your decision.

```{r}
#| output: false

library(ggplot2)
library(dplyr)

ggplot(data=energy_clean_2019, mapping=aes(x=Energy_intensity_per_capita,y=CO2_emission)) +
  geom_point() +
  geom_smooth(method = lm) +
 scale_x_continuous(breaks = seq(0, 400, by = 50), limits = c(0,400)) +
scale_y_continuous(breaks = seq(0, 200, by = 50), limits = c(0, 200))
  
```

Task 2.3 (3p) Why are the other plots the wrong choice for question 2.1?

Plot 1

```{r}
#| echo: false
library(ggplot2)
ggplot(data=energy_clean_2019, mapping=aes(x=Energy_intensity_per_capita,y=CO2_emission)) +
  geom_point() +
geom_smooth(method = "lm", formula = y ~ poly(x, 2)) +
 scale_x_continuous(breaks = seq(0, 650, by = 50)) +
scale_y_continuous(breaks = seq(0, 300, by = 50), limits = c(0, 300))
```

Plot 2

```{r}
#| echo: false
library(ggplot2)
ggplot(data=energy_clean_2019, mapping=aes(x=Energy_intensity_per_capita,y=CO2_emission)) +
  geom_point() +
  geom_smooth(method = lm) +
 scale_x_continuous(breaks = seq(0, 400, by = 50), limits = c(0,400)) +
scale_y_continuous(breaks = seq(0, 200, by = 50), limits = c(0, 200))
```

Plot 3

```{r}
#| echo: false
library(ggplot2)
ggplot(data=energy_clean_2019, mapping=aes(x=Energy_intensity_per_capita,y=CO2_emission)) +
  geom_point() +
  geom_smooth(method = lm) +
 scale_x_continuous(breaks = seq(0, 650, by = 50)) +
scale_y_continuous(breaks = seq(0, 300, by = 50), limits = c(0, 300))
```

Plot 4

```{r}
#| echo: false
library(ggplot2)
ggplot(data=energy_clean_2019, mapping=aes(x=Energy_intensity_per_capita,y=CO2_emission)) +
  geom_point() +
 scale_x_continuous(breaks = seq(0, 650, by = 50)) +
scale_y_continuous(breaks = seq(0, 300, by = 50), limits = c(0, 300))
```

# Task 3: Regression (18p)

We’ve got two models: a linear regression one and a logistic regression, whose results can be found in the code below. Use them to answer the following questions:

linear model:

```{r}
linear_model1 <- lm(CO2_emission ~ Population + GDP , data = energy_clean_2019)
```

logistic model:

```{r}

mean_CO2_emission <- mean(energy_clean_2019$CO2_emission)

energy_clean_2019$high_Co2 <- ifelse(
  energy_clean_2019$CO2_emission < mean_CO2_emission, 
  "0",  
  "1"
)

energy_clean_2019$high_Co2 <- as.factor(energy_clean_2019$high_Co2)


glm(formula = high_Co2 ~ Energy_intensity_by_GDP + Energy_intensity_per_capita, 
    family = binomial, data = energy_clean_2019)
```

### Task 3.1 (4p)

What kind of question do the different models answer? Think of a research question for the given `linear_model` and of a research question for the given`logistic_model`.

## Task 3.2 (4p)

Explain each given model in your own words

## Task 3.3 (2p)

Write down the mathematical formula for each of the models given.

## Task 3.4 (4,5p)

Interpret the coefficients for the linear model (value, meaning, significance), use five post decimal positions

```{r}
options(scipen = 999)

linear_model1 <- lm(CO2_emission ~ Population + GDP , data = energy_clean_2019)
summary(linear_model1)

```

## Task 3.5 (3p)

A friend working with the same dataset chose other variables to explain the CO2 emission of a country. You came up with linear_model1, they came up with linear_model2. Which one would you prefer in terms of the in sample fit?

```{r}
linear_model1 <- lm(CO2_emission ~ Population + GDP , data = energy_clean_2019)
summary(linear_model1)

linear_model2 <- lm(CO2_emission ~ Energy_intensity_per_capita + GDP , data = energy_clean_2019)
summary(linear_model2)
```

## Task 3.5 (4,5p)

Interpret the coefficients for the logistic model (value, meaning, significance), use five post decimal positions

```{r}
mean_CO2_emission <- mean(energy_clean_2019$CO2_emission)

energy_clean_2019$high_Co2 <- ifelse(
  energy_clean_2019$CO2_emission < mean_CO2_emission, 
  "0",  
  "1"
)

energy_clean_2019$high_Co2 <- as.factor(energy_clean_2019$high_Co2)


glm(formula = high_Co2 ~ Energy_intensity_by_GDP + Energy_intensity_per_capita, 
    family = binomial, data = energy_clean_2019)
```

## Task 3.6 (2p)

What kind of problem could occur when we add Energy_consumption and Energy_production as additional regressors to the logistic regression model?
